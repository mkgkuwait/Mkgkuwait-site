<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل متطوع</title>

<style>
body{
  background:#0f1b24;
  color:#fff;
  font-family:Tahoma, Arial;
  margin:0;
}
.page{
  max-width:520px;
  margin:40px auto;
  background:#13232f;
  padding:30px;
  border-radius:12px;
}
header{text-align:center;margin-bottom:20px;}
header img{height:70px;}
input,select{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:6px;
  border:none;
}
button{
  padding:10px 18px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.submit{
  width:100%;
  background:#c9a24d;
  color:#000;
  font-size:16px;
  margin-top:15px;
}
.consent-box{
  background:#1d3342;
  padding:15px;
  border-radius:8px;
  font-size:15px;
  margin-top:10px;
}
canvas{
  display:block;
  margin-top:10px;
  background:#fff;
  border:1px solid #aaa;
}
footer{
  display:flex;
  justify-content:center;
  gap:14px;
  margin:25px 0;
}
footer svg{
  width:22px;
  height:22px;
  fill:#fff;
}
</style>

</head>
<body>

<div class="page">

<header>
  <a href="index.html"><img src="logo.png" alt="logo"></a>
  <h1>تسجيل متطوع</h1>
  <h2>Volunteer Registration</h2>
</header>

<form id="volunteerForm">

<input name="Full_Name" required placeholder="الاسم الكامل">
<input name="Civil_ID" required placeholder="الرقم المدني">
<input type="number" id="age" name="Age" required placeholder="العمر (10–70)">

<select name="Volunteer_Type" required>
  <option value="">اختر مجال التطوع</option>
  <option>الزراعة التجميلية</option>
  <option>صيانة مرافق وخدمات عامة</option>
</select>

<!-- ولي الأمر -->
<div id="guardian" style="display:none">

  <h3>بيانات ولي الأمر</h3>

  <input name="Guardian_Name" placeholder="اسم ولي الأمر">
  <input name="Guardian_Phone" placeholder="رقم هاتف ولي الأمر">

  <div class="consent-box">
    <label>
      <input type="checkbox" id="guardianAgree" name="Guardian_Consent">
      أقر أنا ولي أمر المتقدم، بموافقتي الكاملة على مشاركة ابني/ابنتي
      في الأعمال التطوعية التابعة لمحافظة مبارك الكبير، وأتحمل كامل
      المسؤولية القانونية، وأتعهد بالالتزام بجميع الأنظمة والتعليمات.
    </label>
  </div>

  <p><strong>توقيع ولي الأمر:</strong></p>

  <canvas id="sig" width="400" height="150"></canvas>

  <button type="button" onclick="clearSig()">مسح التوقيع</button>

</div>

<button class="submit" type="submit">إرسال</button>

</form>
</div>

<footer>
  <a href="https://instagram.com/mkgkuwait">
    <svg viewBox="0 0 24 24"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5z"/></svg>
  </a>
  <a href="https://x.com/mkgkuwait">
    <svg viewBox="0 0 24 24"><path d="M18.9 2H22l-7.2 8.2L23 22h-6.8l-5.3-6.5L5.7 22H2.6l7.7-8.8L1 2h7z"/></svg>
  </a>
  <a href="tel:25473556">
    <svg viewBox="0 0 24 24"><path d="M6.6 10.8a15.1 15.1 0 0 0 6.6 6.6l2.2-2.2z"/></svg>
  </a>
</footer>

<script>
const age = document.getElementById("age");
const guardian = document.getElementById("guardian");
const agree = document.getElementById("guardianAgree");
const canvas = document.getElementById("sig");
const ctx = canvas.getContext("2d");
let drawing = false;

/* تهيئة التوقيع */
function resetCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="#000";
  ctx.lineWidth=2;
  ctx.lineCap="round";
}
resetCanvas();

canvas.addEventListener("mousedown",e=>{
  drawing=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
});
canvas.addEventListener("mousemove",e=>{
  if(!drawing) return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
});
["mouseup","mouseleave"].forEach(ev=>{
  canvas.addEventListener(ev,()=>drawing=false);
});

function clearSig(){ resetCanvas(); }

/* منطق العمر */
age.addEventListener("input",()=>{
  const a = parseInt(age.value,10);
  if(a>=10 && a<=17){
    guardian.style.display="block";
    agree.required=true;
  }else{
    guardian.style.display="none";
    agree.required=false;
    resetCanvas();
  }
});

/* الإرسال إلى Google Script */
document.getElementById("volunteerForm").addEventListener("submit",function(e){
  e.preventDefault();

  const form = e.target;
  const data = new FormData(form);
  const a = parseInt(age.value,10);

  if(a>=10 && a<=17){
    if(!agree.checked){
      alert("يجب موافقة ولي الأمر");
      return;
    }
    data.append(
      "Guardian_Signature_Base64",
      canvas.toDataURL("image/png")
    );
  }

  fetch(
    "https://script.google.com/macros/s/AKfycbygn8i590rV6sLcHtjZV2HrcUVSE-VILFyrqqj-bvpIotdPMxK9TpNbvSWeGuMtO_YYMA/exec",
    { method:"POST", body:data }
  ).then(()=>{
    window.location.href="thankyou.html";
  }).catch(()=>{
    alert("فشل الإرسال");
  });
});
</script>

</body>
</html>
