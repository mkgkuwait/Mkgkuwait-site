<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل متطوع</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{background:#0f1b24;color:#fff;font-family:Tahoma;margin:0}
.page{max-width:520px;margin:40px auto;background:#13232f;padding:30px;border-radius:12px}
input,select,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none}
.submit{background:#c9a24d;color:#000;font-size:16px}
.consent-box{background:#1d3342;padding:15px;border-radius:8px}
canvas{background:#fff;border:1px solid #aaa}
</style>
</head>

<body>

<div class="page">
<h2 style="text-align:center">تسجيل متطوع</h2>

<form id="volunteerForm">

<input name="Full_Name" required placeholder="الاسم الكامل">
<input name="Civil_ID" required placeholder="الرقم المدني">
<input type="number" id="age" name="Age" required placeholder="العمر">

<select name="Volunteer_Type" required>
  <option value="">اختر مجال التطوع</option>
  <option>الزراعة التجميلية</option>
  <option>صيانة مرافق وخدمات عامة</option>
</select>

<!-- ولي الأمر -->
<div id="guardian" style="display:none">

<h3>بيانات ولي الأمر</h3>
<input name="Guardian_Name" placeholder="اسم ولي الأمر">
<input name="Guardian_Phone" placeholder="رقم هاتف ولي الأمر">

<div class="consent-box">
<label>
<input type="checkbox" id="guardianAgree">
أقر أنا ولي أمر المتقدم بموافقتي الكاملة على المشاركة وأتحمل المسؤولية القانونية.
</label>
</div>

<p><strong>توقيع ولي الأمر:</strong></p>
<canvas id="sig" width="400" height="150"></canvas>
<button type="button" onclick="clearSig()">مسح التوقيع</button>

</div>

<button class="submit" type="submit">إرسال</button>

</form>
</div>

<script>
emailjs.init("Xi6nq5svDk-vUU0b4");

const SERVICE_ID="service_3jvh0md";
const TEMPLATE_ID="template_jznlquo";

const age=document.getElementById("age");
const guardian=document.getElementById("guardian");
const agree=document.getElementById("guardianAgree");

const canvas=document.getElementById("sig");
const ctx=canvas.getContext("2d");
let drawing=false;

// تجهيز التوقيع
ctx.fillStyle="#fff";
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.strokeStyle="#000";
ctx.lineWidth=2;
ctx.lineCap="round";

canvas.onmousedown=e=>{
  drawing=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
};
canvas.onmousemove=e=>{
  if(!drawing) return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
};
canvas.onmouseup=()=>drawing=false;
canvas.onmouseleave=()=>drawing=false;

function clearSig(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

// منطق العمر
age.oninput=()=>{
  const a=parseInt(age.value,10);
  if(a>=10 && a<=17){
    guardian.style.display="block";
    agree.required=true;
  }else{
    guardian.style.display="none";
    agree.required=false;
    clearSig();
  }
};

// الإرسال
document.getElementById("volunteerForm").addEventListener("submit",e=>{
  e.preventDefault();

  const a=parseInt(age.value,10);
  const data=new FormData(e.target);

  if(a>=10 && a<=17){
    data.append("Guardian_Signature", canvas.toDataURL("image/png"));
  }else{
    data.append("Guardian_Signature","");
  }

  emailjs.send(SERVICE_ID,TEMPLATE_ID,Object.fromEntries(data))
  .then(()=>{
    window.location.href="thankyou.html";
  })
  .catch(err=>{
    alert("فشل الإرسال");
    console.error(err);
  });
});
</script>

</body>
</html>
